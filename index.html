<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eli Perrett | Creative Portfolio</title>

    <!-- SEO & Metadata -->
    <meta name="description" content="Creative portfolio of Eli Perrett, showcasing 3D renders, digital art, and design visualizations." />
    <meta name="author" content="Eli Perrett" />
    <link rel="canonical" href="https://eliperrett.com/" /> <!-- Replace with your actual domain -->

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/eperrett11/Media/main/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/eperrett11/Media/main/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/eperrett11/Media/main/favicon/favicon-16x16.png">
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/eperrett11/Media/main/favicon/favicon.ico">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://eliperrett.com/" /> <!-- Replace with your actual domain -->
    <meta property="og:title" content="Eli Perrett | Creative Portfolio" />
    <meta property="og:description" content="Creative portfolio of Eli Perrett, showcasing 3D renders, digital art, and design visualizations." />
    <meta property="og:image" content="https://raw.githubusercontent.com/eperrett11/Media/main/media/3-Heceta-Vignette-1.JPG" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://eliperrett.com/" /> <!-- Replace with your actual domain -->
    <meta property="twitter:title" content="Eli Perrett | Creative Portfolio" />
    <meta property="twitter:description" content="Creative portfolio of Eli Perrett, showcasing 3D renders, digital art, and design visualizations." />
    <meta property="twitter:image" content="https://raw.githubusercontent.com/eperrett11/Media/main/media/3-Heceta-Vignette-1.JPG" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Roboto+Mono:wght@100..700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Roboto Mono', 'monospace'],
              display: ['Montserrat', 'sans-serif'],
            },
            transitionDuration: {
              '700': '700ms',
            },
          },
        },
      }
    </script>
    <style>
      @keyframes fade-slide-up {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-letter-in {
        display: inline-block;
        opacity: 0;
        animation-name: fade-slide-up;
        animation-duration: 0.3s;
        animation-fill-mode: both;
        animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
      }
      .animate-text-in {
        opacity: 0;
        animation-name: fade-slide-up;
        animation-duration: 0.3s;
        animation-fill-mode: both;
        animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
      }
      @keyframes slide-in-from-left {
        from {
          opacity: 0;
          transform: translateX(-80px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .animate-slide-in-left {
        opacity: 0;
        animation: slide-in-from-left 1.8s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
      }
      @keyframes gentle-bob {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-6px);
        }
      }
      .animate-gentle-bob {
        animation: gentle-bob 2.5s ease-in-out infinite;
      }
      .masonry-item {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
        transition: opacity 1s cubic-bezier(0.165, 0.84, 0.44, 1),
                    transform 0.4s ease-out;
        position: relative;
        background-color: #e5e7eb;
      }
      .masonry-item.is-visible {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      .item-content-wrapper {
        height: 100%;
        width: 100%;
        transition: transform 0.4s ease-out;
        will-change: transform;
        backface-visibility: hidden;
      }
      /* Hover effects only for non-touch devices, added via JS */
      .can-hover .masonry-item.is-visible:hover {
        z-index: 10;
      }
      .can-hover .masonry-item:hover .item-content-wrapper {
        transform: scale(1.03);
      }
      .can-hover .group:hover .group-hover-overlay { opacity: 1; }
      .can-hover .group:hover .group-hover-title { opacity: 1; }
      body {
        background-color: #F3F4F6; /* Tailwind gray-100 */
        overflow-x: hidden;
        overflow-y: scroll;
      }
      body::before {
        content: '';
        position: fixed;
        inset: 0;
        background-image: radial-gradient(circle, rgba(0, 0, 0, 0.06) 1px, transparent 1px);
        background-size: 20px 20px;
        z-index: 0;
        pointer-events: none;
      }
      #root {
        position: relative;
        z-index: 1;
      }
      .nav-link::after {
        content: '';
        position: absolute;
        bottom: 4px; /* Position underline below text */
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 2px;
        background-color: black;
        transition: width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      @media (min-width: 1024px) { /* lg breakpoint */
        .nav-link[aria-current="page"]::after,
        .can-hover .nav-link:hover::after {
          width: 100%;
        }
      }
      .hidden {
        display: none;
      }
      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
      .balanced-text {
        text-wrap: balance;
      }
      /* Flip Card Animation */
      .flip-container {
        perspective: 1000px;
      }
      .flipper {
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
      }
      .can-hover .flip-container:hover .flipper {
        transform: rotateY(180deg);
      }
      .front, .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
      }
      .back {
        transform: rotateY(180deg);
      }
      @keyframes auto-flip-once {
        0% { transform: rotateY(0deg); }
        40% { transform: rotateY(180deg); }
        60% { transform: rotateY(180deg); }
        100% { transform: rotateY(0deg); }
      }
      .animate-flip-once {
        animation: auto-flip-once 1.5s cubic-bezier(0.455, 0.03, 0.515, 0.955);
      }
      /* Fix for initial animation jitter on hover */
      #about-section a[target="_blank"],
      #back-to-top-container svg,
      #copy-icon-container {
        transform: translateZ(0);
        -webkit-transform: translateZ(0); /* For older Safari */
      }
      /* Mobile-specific modal navigation */
      @media (max-width: 1023px) {
        #modal-nav-container {
          position: fixed;
          bottom: 1.5rem;
          left: 50%;
          transform: translateX(-50%);
          margin-top: 0;
        }
      }
    </style>
</head>
  <body class="text-gray-700">
    <div id="root" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <header class="flex flex-col md:flex-row md:justify-between md:items-center text-center md:text-left mb-12 sm:mb-16">
        <div class="flex flex-col md:flex-row items-center">
          <img
            src="https://raw.githubusercontent.com/eperrett11/Media/main/media/eli-bike-logo.png"
            alt="Eli Perrett Logo"
            class="w-48 h-48 sm:w-56 sm:h-56 mb-6 md:mb-0 md:mr-8 lg:mr-12 flex-shrink-0 rounded-full animate-slide-in-left object-contain"
          />
          <div>
            <div class="flex items-center justify-center md:justify-start mb-2">
              <h1 id="animated-header" class="font-display text-2xl sm:text-3xl md:text-2xl lg:text-4xl font-black text-black">
                <span class="tracking-wider">
                  ELI
                </span>
                <span>&nbsp;</span>
                <span class="tracking-wider">
                  PERRETT
                </span>
                <span>&nbsp;</span>
                <span class="tracking-wider font-light text-gray-600">
                  CREATIVE
                </span>
              </h1>
            </div>
            <p
              class="text-lg text-gray-600 max-w-md sm:max-w-lg mx-auto md:mx-0 animate-text-in balanced-text"
              style="animation-delay: 1000ms"
            >
              Blending technology and artistry to help designers and brands
              communicate ideas.
            </p>
          </div>
        </div>
        <nav class="mt-8 md:mt-0 md:mr-8 lg:mr-12">
          <ul class="flex items-center justify-center space-x-2 sm:space-x-4">
            <li>
              <a href="#" data-section="work-section" aria-current="page" class="nav-link relative font-sans text-lg tracking-wide transition-colors duration-200 px-4 py-2 rounded-lg bg-gray-800 text-white md:bg-transparent md:text-gray-800 md:hover:text-black md:px-3 md:py-2 md:rounded-none">
                Work
              </a>
            </li>
             <li>
              <a href="#" data-section="about-section" class="nav-link relative font-sans text-lg tracking-wide transition-colors duration-200 px-4 py-2 rounded-lg bg-gray-200 text-gray-700 md:bg-transparent md:text-gray-800 md:hover:text-black md:px-3 md:py-2 md:rounded-none">
                Info
              </a>
            </li>
          </ul>
        </nav>
      </header>

      <main>
        <section id="work-section" class="content-section animate-fade-in">
            <div class="text-center my-16 sm:my-24">
                <h2 class="text-sm font-medium uppercase text-gray-500 tracking-[0.4em]">
                Selected Works
                </h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mt-6 text-gray-400 animate-gentle-bob" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5L12 21m0 0l-7.5-7.5M12 21V3"></path>
                </svg>
            </div>
            <div id="loader" class="flex justify-center items-center py-24 text-center">
                <div>
                    <svg class="animate-spin mx-auto h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-lg text-gray-600">Loading portfolio...</p>
                </div>
            </div>
            <div id="portfolio-grid" class="hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
                <!-- Renders will be dynamically inserted here via JS into column divs -->
            </div>
             <div id="back-to-top-container" class="hidden text-center my-16 sm:my-24">
                <a href="#root" class="group inline-flex flex-col items-center text-sm font-medium uppercase text-gray-500 tracking-[0.4em] hover:text-gray-800 transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-4 text-gray-400 group-hover:text-gray-600 transition-colors duration-300 transform group-hover:-translate-y-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19.5v-15m0 0l-6.75 6.75M12 4.5l6.75 6.75" />
                    </svg>
                    Back to Top
                </a>
            </div>
        </section>

        <section id="about-section" class="content-section hidden py-16 sm:py-24 animate-fade-in">
            <div class="max-w-7xl mx-auto">
                <div class="flex flex-col md:flex-row items-center gap-12 lg:gap-16">
                    <!-- Left Column: Image -->
                    <div class="flex-shrink-0 w-full md:w-auto">
                        <div class="flip-container w-80 h-80 sm:w-96 sm:h-96 md:w-[448px] md:h-[448px] mx-auto md:mx-0">
                            <div class="flipper w-full h-full">
                                <div class="front w-full h-full">
                                    <img src="https://raw.githubusercontent.com/eperrett11/Media/main/media/Eli_Headshot1.png" alt="Eli Perrett Headshot" class="w-full h-full object-contain">
                                </div>
                                <div class="back w-full h-full">
                                    <img src="https://raw.githubusercontent.com/eperrett11/Media/main/media/Eli_Headshot2.png" alt="Eli Perrett Headshot (alternate)" class="w-full h-full object-contain">
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- Right Column: Text -->
                    <div class="text-center md:text-left md:max-w-2xl">
                        <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4 tracking-tight">
                            Hi, I'm Eli
                        </h2>
                        <p class="text-lg text-gray-600 mb-6 leading-relaxed">
                            I’m endlessly exploring new ways to visualize design ideas. Along the way, I’ve built an extensive skill set in 3D modeling, rendering, and generative AI - working on projects ranging from large-scale urban developments, brand activations, resort masterplans, bespoke interiors, and the occasional favor for a friend.
                        </p>
                        <p class="text-lg text-gray-600 mb-6 leading-relaxed">
                            When I’m not at my desk, I’m probably outdoors - skiing, cycling, surfing, or seeking a new adventure.
                        </p>
                        <p class="text-lg text-gray-600">
                            Currently based in Bend, OR.
                        </p>
                    </div>
                </div>
                
                <div class="mt-24 sm:mt-32 text-center">
                    <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4 tracking-tight">
                        Thanks for stopping by
                    </h2>
                    <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto balanced-text">
                        Have a project in mind or just want to say hello?
                    </p>
                    <div class="mt-4">
                        <button id="copy-email-btn" class="group relative inline-flex items-center gap-x-3 bg-transparent text-gray-900 font-bold py-3 px-8 rounded-xl border-2 border-gray-900 hover:bg-gray-900 hover:text-white focus:outline-none transition-all duration-300 text-lg">
                            <span id="email-text" class="font-sans">eperrett11@gmail.com</span>
                            <span id="copy-icon-container" class="transition-transform duration-300 group-hover:rotate-[-12deg]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 256 256" fill="currentColor">
                                    <path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8,8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path>
                                </svg>
                            </span>
                            <span id="check-icon-container" class="hidden">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" viewBox="0 0 256 256" fill="currentColor">
                                    <path d="M229.66,77.66l-128,128a8,8,0,0,1-11.32,0l-56-56a8,8,0,0,1,11.32-11.32L96,188.69,218.34,66.34a8,8,0,0,1,11.32,11.32Z"></path>
                                </svg>
                            </span>
                        </button>
                    </div>

                    <div class="flex justify-center items-center space-x-6 mt-8">
                        <a href="https://www.linkedin.com/in/eli-perrett" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-900 transform hover:scale-110 transition-all duration-300" aria-label="LinkedIn Profile">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor">
                               <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                           </svg>
                        </a>
                        <a href="https://www.instagram.com/eperrett" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-900 transform hover:scale-110 transition-all duration-300" aria-label="Instagram Profile">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor">
                               <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0 3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44 1.441-.645 1.441-1.44-.645-1.44-1.441-1.44z"/>
                            </svg>
                        </a>
                    </div>

                </div>
            </div>
        </section>

      </main>

    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black lg:bg-opacity-90 flex flex-col items-center justify-center z-50 p-4">
        <div id="modal-content" class="flex flex-col items-center">
            <!-- Image will be inserted here -->
        </div>

        <div id="modal-nav-container" class="flex items-center justify-center mt-4 space-x-8">
            <button id="modal-prev" class="text-white bg-black bg-opacity-30 rounded-full p-2 hover:bg-opacity-50 transition-all z-20" aria-label="Previous image">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <button id="modal-next" class="text-white bg-black bg-opacity-30 rounded-full p-2 hover:bg-opacity-50 transition-all z-20" aria-label="Next image">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </div>
      
        <button id="modal-close" class="absolute top-4 sm:top-6 right-4 sm:right-6 text-white bg-black bg-opacity-30 rounded-full p-2 hover:bg-opacity-50 transition-colors z-20" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- Portfolio Specific --- (Variables needed by other functions)
        let portfolioItems = [];
        let currentModalIndex = -1;
        let savedScrollY = 0;
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        if (!isTouchDevice) {
            document.body.classList.add('can-hover');
        }

        // --- EDIT DESCRIPTIONS HERE ---
        const PORTFOLIO_DESCRIPTIONS = {
          'render-1': 'This is a description for Render 1. You can add details about the software used, the concept, etc.',
          'project-x-view-2': 'A detailed look at the second view of Project X, focusing on material and lighting.',
        };
        
        let mediaFetched = false;

        // --- Back to Top Button ---
        const backToTopContainer = document.getElementById('back-to-top-container');
        let handleScroll = () => {}; // Declare here to be available for nav handler
        if (backToTopContainer) {
            const backToTopBtn = backToTopContainer.querySelector('a');

            handleScroll = () => {
                const workSection = document.getElementById('work-section');
                const isWorkVisible = workSection && !workSection.classList.contains('hidden');
                const hasScrolledEnough = window.scrollY > window.innerHeight * 0.75;
                const hasContent = portfolioItems && portfolioItems.length > 0;

                if (isWorkVisible && hasScrolledEnough && hasContent) {
                    backToTopContainer.classList.remove('hidden');
                    backToTopContainer.classList.add('animate-fade-in');
                } else {
                    backToTopContainer.classList.add('hidden');
                    backToTopContainer.classList.remove('animate-fade-in');
                }
            };
            
            window.addEventListener('scroll', handleScroll, { passive: true });

            backToTopBtn.addEventListener('click', (e) => {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
        
        // --- Navigation ---
        const navLinks = document.querySelectorAll('nav a');
        const contentSections = document.querySelectorAll('.content-section');

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const clickedLink = e.currentTarget;
                const targetId = clickedLink.dataset.section;

                if (clickedLink.getAttribute('aria-current') === 'page') {
                    return;
                }

                navLinks.forEach(navLink => {
                    navLink.removeAttribute('aria-current');
                    navLink.classList.remove('bg-gray-800', 'text-white');
                    navLink.classList.add('bg-gray-200', 'text-gray-700');
                });
                clickedLink.setAttribute('aria-current', 'page');
                clickedLink.classList.remove('bg-gray-200', 'text-gray-700');
                clickedLink.classList.add('bg-gray-800', 'text-white');
                
                contentSections.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                
                if (targetId === 'about-section') {
                    const flipper = document.querySelector('#about-section .flipper');
                    if (flipper) {
                        flipper.classList.remove('animate-flip-once');
                        setTimeout(() => {
                            flipper.classList.add('animate-flip-once');
                            flipper.addEventListener('animationend', () => {
                                flipper.classList.remove('animate-flip-once');
                            }, { once: true });
                        }, 50);
                    }
                }
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                setTimeout(handleScroll, 50);
            });
        });

        const GITHUB_MEDIA_API_URL = 'https://api.github.com/repos/eperrett11/Media/contents/media';
        const GITHUB_VIDEOS_API_URL = 'https://api.github.com/repos/eperrett11/Media/contents/videos';

        const grid = document.getElementById('portfolio-grid');
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        const modalCloseBtn = document.getElementById('modal-close');
        const modalNextBtn = document.getElementById('modal-next');
        const modalPrevBtn = document.getElementById('modal-prev');
        
        // --- Core Functions ---
        const fetchAllMedia = async () => {
            if (mediaFetched) return;
            mediaFetched = true;
            try {
                const [mediaResponse, videosResponse] = await Promise.all([
                    fetch(GITHUB_MEDIA_API_URL),
                    fetch(GITHUB_VIDEOS_API_URL)
                ]);

                if (!mediaResponse.ok || !videosResponse.ok) {
                    throw new Error(`Failed to fetch media from GitHub. Status: ${mediaResponse.status}, ${videosResponse.status}`);
                }
                
                const allMediaFiles = await mediaResponse.json();
                const allVideoRepoFiles = await videosResponse.json();

                // --- Process Images ---
                const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];
                const ignoredFiles = ['eli-bike-logo.png', 'Eli_Headshot1.png', 'Eli_Headshot2.png'];

                const imageFiles = allMediaFiles.filter(file => {
                    if (file.type !== 'file' || !file.download_url || ignoredFiles.includes(file.name)) {
                        return false;
                    }
                    const extension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
                    return imageExtensions.includes(extension);
                });
                
                const images = imageFiles.map((file) => {
                    const rawBaseName = file.name.substring(0, file.name.lastIndexOf('.'));
                    const titleName = rawBaseName.replace(/^\d+[a-zA-Z]?-/i, ''); 
                    const title = titleName.replace(/[-_]/g, ' ').trim().replace(/\b\w/g, l => l.toUpperCase());
                    const key = rawBaseName.replace(/[\s_-]/g, '-').toLowerCase();

                    return {
                        type: 'image',
                        imageUrl: file.download_url,
                        title: title,
                        originalName: file.name,
                        description: PORTFOLIO_DESCRIPTIONS[key] || ''
                    };
                });

                // --- Process Videos ---
                const posterMap = new Map();
                allVideoRepoFiles
                    .filter(file => imageExtensions.includes(file.name.substring(file.name.lastIndexOf('.')).toLowerCase()))
                    .forEach(file => {
                        const key = file.name.split(' - ')[0];
                        posterMap.set(key, file.download_url);
                    });
                
                const videoFiles = allVideoRepoFiles.filter(file => file.name.toLowerCase().endsWith('.mp4'));

                const videos = videoFiles.map(file => {
                    const rawBaseName = file.name.substring(0, file.name.lastIndexOf('.'));
                    const titleName = rawBaseName.replace(/^\d+[a-zA-Z]?-/i, '');
                    const title = titleName.replace(/[-_]/g, ' ').trim().replace(/\b\w/g, l => l.toUpperCase());
                    const key = rawBaseName.replace(/[\s_-]/g, '-').toLowerCase();

                    return {
                        type: 'video',
                        videoUrl: file.download_url,
                        posterUrl: posterMap.get(rawBaseName) || '',
                        title: title,
                        originalName: file.name,
                        description: PORTFOLIO_DESCRIPTIONS[key] || ''
                    };
                });

                portfolioItems = [...images, ...videos]
                    .sort((a, b) => (a.originalName || '').localeCompare(b.originalName || ''));
                
                if (portfolioItems.length === 0) {
                   document.getElementById('loader').classList.add('hidden');
                   grid.innerHTML = `<div class="text-center text-gray-500 bg-white p-8 rounded-lg shadow-sm col-span-full"><h3 class="text-xl font-semibold mb-2 text-gray-800">Your portfolio is empty.</h3><p>Upload media to your GitHub repository.</p></div>`;
                   grid.classList.remove('hidden');
                   return;
                }

                portfolioItems.forEach((item, index) => {
                    item.id = index;
                });
                
                renderGrid(portfolioItems);
                handleScroll();

            } catch (error) {
                console.error("Error fetching portfolio:", error);
                document.getElementById('loader').classList.add('hidden');
                grid.innerHTML = `<div class="text-center text-red-500 bg-red-100 p-8 rounded-lg shadow-sm col-span-full"><h3 class="text-xl font-semibold mb-2 text-red-800">Could not load portfolio.</h3><p>${error.message}</p></div>`;
                grid.classList.remove('hidden');
            }
        };

        const createGridItem = (itemData) => {
            const item = document.createElement('div');
            const baseItemClasses = 'masonry-item relative overflow-hidden rounded-lg cursor-pointer shadow-lg w-full [break-inside:avoid]';
            item.className = `${baseItemClasses} group`;
            item.onclick = () => openModal(itemData.id);

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'item-content-wrapper';

            if (itemData.type === 'video') {
                const video = document.createElement('video');
                video.src = itemData.videoUrl;
                video.poster = itemData.posterUrl;
                video.muted = true;
                video.loop = true;
                video.playsInline = true;
                video.className = 'w-full h-full object-cover';
                video.preload = 'metadata';

                video.addEventListener('loadedmetadata', () => {
                    if (!item.style.aspectRatio) {
                        item.style.aspectRatio = `${video.videoWidth} / ${video.videoHeight}`;
                    }
                }, { once: true });
                
                if (!isTouchDevice) {
                    item.addEventListener('mouseenter', () => video.play().catch(e => console.log("Autoplay prevented on hover.")));
                    item.addEventListener('mouseleave', () => {
                        video.pause();
                        video.currentTime = 0;
                    });
                }
                contentWrapper.appendChild(video);
            } else { // 'image'
                const img = document.createElement('img');
                img.src = itemData.imageUrl;
                img.alt = itemData.title;
                img.loading = 'lazy';
                img.className = 'w-full h-full object-cover';

                img.addEventListener('load', () => {
                    if (!item.style.aspectRatio) {
                        item.style.aspectRatio = `${img.naturalWidth} / ${img.naturalHeight}`;
                    }
                }, { once: true });
                contentWrapper.appendChild(img);
            }

            item.appendChild(contentWrapper);

            const titleOverlay = document.createElement('div');
            titleOverlay.className = 'absolute inset-0 bg-gradient-to-t from-black/75 to-transparent opacity-0 group-hover-overlay transition-opacity duration-300 pointer-events-none z-10';
            item.appendChild(titleOverlay);

            const title = document.createElement('h3');
            title.textContent = itemData.title;
            title.className = 'absolute bottom-0 left-0 p-4 text-white font-semibold text-lg opacity-0 group-hover-title transition-opacity duration-500 delay-100 pointer-events-none z-10';
            item.appendChild(title);

            return item;
        };

        const renderGrid = (items) => {
            const grid = document.getElementById('portfolio-grid');
            const loader = document.getElementById('loader');
            grid.innerHTML = '';

            const getColumnCount = () => {
                if (window.matchMedia('(min-width: 1024px)').matches) return 4;
                if (window.matchMedia('(min-width: 768px)').matches) return 3;
                return 2;
            };
            const numColumns = getColumnCount();

            const columns = Array.from({ length: 4 }, () => {
                const col = document.createElement('div');
                col.className = 'flex flex-col gap-4 sm:gap-6';
                return col;
            });

            const unassignedItems = [];
            items.forEach(item => {
                const match = (item.originalName || '').match(/^(\d+)/);
                if (match) {
                    const colIndex = parseInt(match[1], 10) - 1;
                    if (colIndex >= 0 && colIndex < 4) {
                        columns[colIndex].appendChild(createGridItem(item));
                        return;
                    }
                }
                unassignedItems.push(item);
            });

            unassignedItems.forEach((item, index) => {
                const colIndex = index % numColumns;
                columns[colIndex].appendChild(createGridItem(item));
            });
            
            columns.forEach(col => grid.appendChild(col));

            loader.classList.add('hidden');
            grid.classList.remove('hidden');

            const fadeInObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.masonry-item').forEach(item => {
                fadeInObserver.observe(item);
            });
        };

        const openModal = (index) => {
            if (index < 0 || index >= portfolioItems.length) return;
            
            currentModalIndex = index;
            const item = portfolioItems[currentModalIndex];
            
            let mediaHTML = '';
            if (item.type === 'video') {
                mediaHTML = `<video key="${item.id}" src="${item.videoUrl}" poster="${item.posterUrl}" class="w-auto h-auto max-w-[80vw] max-h-[70vh] object-contain rounded-lg shadow-2xl" autoplay muted controls loop playsinline></video>`;
            } else {
                mediaHTML = `<img key="${item.id}" src="${item.imageUrl}" alt="${item.title}" class="w-auto h-auto max-w-[80vw] max-h-[70vh] object-contain rounded-lg shadow-2xl">`;
            }

            let textContainerHTML = '<div class="w-full max-w-[80vw] mt-4 px-2 text-right">';
            textContainerHTML += `<h3 class="text-white font-light text-base sm:text-lg opacity-90">${item.title}</h3>`;
            if (item.description) {
                textContainerHTML += `<p class="mt-1 text-gray-300 text-sm max-w-lg ml-auto balanced-text">${item.description}</p>`;
            }
            textContainerHTML += '</div>';
            
            modalContent.innerHTML = mediaHTML + textContainerHTML;
            modal.classList.remove('hidden');
            modal.classList.add('animate-fade-in');
            
            if (isTouchDevice) {
                savedScrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${savedScrollY}px`;
                document.body.style.width = '100%';
            } else {
                document.body.style.overflow = 'hidden';
            }

            window.addEventListener('keydown', handleKeyDown);
        };

        const closeModal = () => {
            modal.classList.add('hidden');
            modal.classList.remove('animate-fade-in');
            modalContent.innerHTML = '';
            
            if (isTouchDevice) {
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                window.scrollTo(0, savedScrollY);
            } else {
                document.body.style.overflow = '';
            }

            window.removeEventListener('keydown', handleKeyDown);
        };
        
        const showNext = () => openModal((currentModalIndex + 1) % portfolioItems.length);
        const showPrevious = () => openModal((currentModalIndex - 1 + portfolioItems.length) % portfolioItems.length);

        // --- Event Handlers & Setup ---
        const handleKeyDown = (e) => {
            if (e.key === 'Escape') closeModal();
            if (e.key === 'ArrowRight') showNext();
            if (e.key === 'ArrowLeft') showPrevious();
        };

        const setupHeaderAnimations = () => {
          const header = document.getElementById('animated-header');
          const textNodes = Array.from(header.children).map(child => child.textContent.trim());
          header.innerHTML = '';
          let totalDelay = 800;
          const letterDelay = 50;

          textNodes.forEach((text, textIndex) => {
            const spanContainer = document.createElement('span');
            if (textIndex === 0 || textIndex === 2) spanContainer.className = 'tracking-wider';
            if (textIndex === 4) spanContainer.className = 'tracking-wider font-light text-gray-600';
            
            text.split('').forEach((char) => {
              const charSpan = document.createElement('span');
              charSpan.className = 'animate-letter-in';
              charSpan.textContent = char;
              charSpan.style.animationDelay = `${totalDelay}ms`;
              spanContainer.appendChild(charSpan);
              totalDelay += letterDelay;
            });

            if (text === '&nbsp;') {
               const spaceSpan = document.createElement('span');
               spaceSpan.innerHTML = '&nbsp;';
               header.appendChild(spaceSpan);
            } else {
               header.appendChild(spanContainer);
            }

            if (textIndex % 2 === 0 && textIndex < textNodes.length -1) {
                const spaceSpan = document.createElement('span');
                spaceSpan.innerHTML = '&nbsp;';
                spaceSpan.className = 'animate-letter-in';
                spaceSpan.style.animationDelay = `${totalDelay}ms`;
                header.appendChild(spaceSpan);
                totalDelay += letterDelay;
            }
          });
        };

        // --- Initialisation ---
        setupHeaderAnimations();

        modalCloseBtn.addEventListener('click', closeModal);
        modalNextBtn.addEventListener('click', showNext);
        modalPrevBtn.addEventListener('click', showPrevious);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // --- Copy Email Button ---
        const copyEmailBtn = document.getElementById('copy-email-btn');
        if (copyEmailBtn) {
            const emailTextSpan = document.getElementById('email-text');
            const copyIconContainer = document.getElementById('copy-icon-container');
            const checkIconContainer = document.getElementById('check-icon-container');
            const originalButtonText = emailTextSpan.textContent;

            copyEmailBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(originalButtonText).then(() => {
                    emailTextSpan.textContent = 'Copied!';
                    copyIconContainer.classList.add('hidden');
                    checkIconContainer.classList.remove('hidden');

                    setTimeout(() => {
                        emailTextSpan.textContent = originalButtonText;
                        copyIconContainer.classList.remove('hidden');
                        checkIconContainer.classList.add('hidden');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy email to clipboard:', err);
                    alert('Failed to copy email. Please copy it manually.');
                });
            });
        }
        
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (portfolioItems.length > 0) {
                    if (window.innerWidth >= 768) {
                        renderGrid(portfolioItems);
                    }
                }
            }, 250);
        });

        fetchAllMedia();
      });
    </script>
</body>
</html>